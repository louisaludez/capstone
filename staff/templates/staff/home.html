{% extends 'base.html' %} {% load static %} {% block title %}
  Staff
{% endblock %} {% block extra_head %}
  <!-- CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="{% static 'personnel.css' %}" />
{% endblock %} {% block sidebar %}
  {% include './includes/personnel-sidebar.html' with active_page='dashboard' %}
{% endblock %} {% block content %}
  <div class="main">
    <h2 style="margin-left: 30px; margin-top: 20px">Front Office</h2>
    <div class="row">
      <div class="div1 vacant">R1</div>
      <div class="div2 vacant">R2</div>
      <div class="div3">
        <span>View Logs</span>
        <input class="form-control" type="date" />
      </div>
      <div class="div6 maintinance">R6</div>
      <div class="div7 occupied">R7</div>
      <div class="div8 vacant">R3</div>
      <div class="div9 occupied">R4</div>
      <div class="div10 occupied">R5</div>
      <div class="div11 vacant">R8</div>
      <div class="div12 vacant">R9</div>
      <div class="div13 occupied">R10</div>
      <div class="div14 maintinance">R11</div>
      <div class="div15 vacant">R12</div>
    </div>
    <div class="row2">
      <div class="walk-in">
        <button class="btn" id="walkinBTN">Walk-in</button>
      </div>
      <div class="check-in">
        <button class="btn" id="check-in-modal">Check-in</button>
      </div>
      <div class="check-out">
        <a href="" class="btn checkoutt">Check-out</a>
      </div>
      <div class="view-reservations">
        <a href="" class="btn">View Reservations</a>
      </div>
    </div>

    <div class="row3">
      <div class="room-information">
        <div class="room-info-label">Room Information :</div>
        <div class="cont">
          <div class="col1">
            <div class="RI-vacant">
              <div class="vacant-box vacant">3</div>
              <span>Vacant</span>
            </div>
            <div class="RI-occupied">
              <div class="occupied-box occupied">3</div>
              <span>Occupied</span>
            </div>
          </div>
          <div class="col2">
            <div class="RI-under_maintinance">
              <div class="under_maintinance-box maintinance">2</div>
              <span>Under Maintenance</span>
            </div>
            <div class="RI-housekeeping">
              <div class="housekeeping-box housekeeping">2</div>
              <span>Housekeeping</span>
            </div>
          </div>
          <div class="col3">
            <div class="RI-reserved">
              <div class="reserved-box reserved">0</div>
              <span>Reserved</span>
            </div>
            <div class="total">
              <span>Total: 100</span>
            </div>
          </div>
        </div>
      </div>
      <div class="rooms-occupied">
        <span style="text-decoration: none !important">Rooms Occupied :</span>
        <div class="ro-deluxe mt-3">
          <span>Deluxe</span>
          <div class="ro-count" style="text-decoration: underline">3</div>
        </div>
        <div class="ro-family">
          <span>Family</span>
          <div class="ro-count" style="text-decoration: underline">2</div>
        </div>
        <div class="ro-standard">
          <span>Standard</span>
          <div class="ro-count" style="text-decoration: underline">1</div>
        </div>
      </div>
    </div>
  </div>
  {% include './includes/walk-in-modal.html' %} {% include './includes/check-in-modal.html' %}
{% endblock %} {% block extra_js %}
  <script>
    flatpickr('#calendar', {
      dateFormat: 'Y-m-d',
      disableMobile: true, // Forces desktop-style calendar on mobile
      monthSelectorType: 'static' // Ensure month/year are always visible
    })
    flatpickr('#check-in', {
      dateFormat: 'Y-m-d',
      disableMobile: true,
      monthSelectorType: 'static' // Ensure month/year are always visible
    })
    flatpickr('#check-out', {
      dateFormat: 'Y-m-d',
      disableMobile: true,
      monthSelectorType: 'static' // Ensure month/year are always visible
    })
  </script>
  <script>
    function updateCardFields() {
      const paymentMethod = document.getElementById('payment-method')
      const cardFields = document.querySelectorAll('.card-fields')
      if (paymentMethod.value === 'credit-card') {
        cardFields.forEach((field) => {
          field.hidden = false // Show the field
        })
      } else {
        cardFields.forEach((field) => {
          field.hidden = true // Hide the field
        })
      }
    }
    
    var modal = document.getElementById('walkin')
    var check_inModal = document.getElementById('checkin')
    // Get the button that opens the modal
    var btn = document.getElementById('walkinBTN')
    var check_inBtn = document.getElementById('check-in-modal')
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName('close')[0]
    // When the user clicks on the button, open the modal
    let walkInTimerInterval = null
    btn.onclick = function () {
      var fivemunutes = 5 * 60,
        display = document.getElementById('walkin-timer') // 5 minutes in seconds
      modal.style.display = 'block'
    
      startWalkInTimer(fivemunutes, display) // Start the timer when the modal opens
      updateCardFields()
    }
    check_inBtn.onclick = function (event) {
      event.preventDefault() // Prevent default link behavior
      check_inModal.style.display = 'block'
      startCheckInTimer()
      updateCardFields()
    }
    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      modal.style.display = 'none'
    }
    // When the user clicks anywhere outside of the modal content, close it
    window.onclick = function (event) {
      if (event.target === modal) {
        modal.style.display = 'none'
        clearInterval(walkInTimerInterval) // Clear the timer when modal is closed
        walkInTimerInterval = null // Reset the interval variable
      } else if (event.target === check_inModal) {
        check_inModal.style.display = 'none'
      }
    }
    // Handle payment method selection
    document.addEventListener('DOMContentLoaded', function () {
      const paymentMethod = document.getElementById('payment-method')
      updateCardFields()
      paymentMethod.addEventListener('change', updateCardFields)
    })
    
    function startWalkInTimer(duration, display) {
      var timer = duration,
        minutes,
        seconds
      walkInTimerInterval = setInterval(function () {
        minutes = parseInt(timer / 60, 10)
        seconds = parseInt(timer % 60, 10)
        minutes = minutes < 10 ? minutes : minutes
        seconds = seconds < 10 ? '0' + seconds : seconds
    
        display.textContent = minutes + ':' + seconds
        console.log(display.textContent)
        if (--timer < 0) {
          timer = duration
          clearInterval(walkInTimerInterval)
          walkInTimerInterval = null
          modal.style.display = 'none' // Close the modal when time is up
          Swal.fire({
            title: `<h1 style="color:red;">Activity Failed</h1>`,
            text: 'Please complete the walk-in process.',
            showCloseButton: true,
            confirmButtonText: `
                                                                                                                                                                                                                                                <i class="fa fa-thumbs-up"></i> Close
                                                                                                                                                                                                                                              `,
            html: '<p>Time Remaining : 0:00 Minutes<br>Time Consumed : 5:00 Minutes</p>',
            icon: 'error',
            customClass: {
              confirmButton: 'my-confirm-btn-walkin'
            }
          })
        }
      }, 100)
    }
    
    function startCheckInTimer() {
      let duration = 5 * 60 // 5 minutes in seconds
      const timerDisplay = document.getElementById('checkin-timer')
    
      const countdown = setInterval(() => {
        const minutes = Math.floor(duration / 60)
        const seconds = duration % 60
    
        timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`
    
        if (--duration < 0) {
        }
      }, 1000)
    }
    document.querySelector('.checkoutt').addEventListener('click', function (event) {
      event.preventDefault() // Prevent default link behavior
      Swal.fire({
        title: 'The Internet?',
        text: 'That thing is still around?',
        icon: 'question'
      })
    })
    document.getElementById('book-room').addEventListener('click', function (event) {
      event.preventDefault() // Prevent default form submission
      clearInterval(walkInTimerInterval)
      walkInTimerInterval = null
      modal.style.display = 'none'
      Swal.fire({
        title: 'Room  Successfully Booked!',
        text: 'Your room has been booked.',
        html: '<p style="color:#1a2d1e">Transaction recorded! <i>Guest Name: Juan Dela Cruz</i><br>Room no. 01<br>Reference no. 00001</p>',
        icon: 'success',
        customClass: {
          confirmButton: 'my-confirm-btn-booking',
          denyButton: 'my-deny-btn-booking',
          title: 'my-title-booking',
          text: 'my-text-booking'
        },
        denyButtonColor: 'green',
        showDenyButton: true,
    
        confirmButtonText: 'View Receipt',
        denyButtonText: 'Activity Results'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: '',
            showCloseButton: true,
            html: `
                                  <div style="font-family: Arial, sans-serif; text-align: center; font-size: 13px; color: #000;">
                                  <img src="{% static 'images/New HMS-B.png'%}" alt="ACES Logo" style="width: 100px; margin-bottom: 10px;">
                                    <p style="margin: 4px 0;">ACES Polytechnic College Inc.</p>
                                    <p style="margin: 4px 0;">Panabo Circumferential Rd, San Francisco,</p>
                                    <p style="margin: 4px 0;">Panabo City, Davao del Norte, Philippines</p>
                                    <hr style="border: 1px dashed #333; margin: 10px 0;">
                                    <p style="margin: 4px 0;">Date and Time: 13/04/2025 06:55 PM</p>
                                    <p style="margin: 4px 0;">Receipt no. <strong>00001</strong></p>
                                    <hr style="border: 1px dashed #333; margin: 10px 0;">
                                    <table style="width: 100%; font-size: 12px; margin-bottom: 10px;">
                                      <tr>
                                      <th style="text-align: left;">Room Type</th>
                                      <th>Qty</th>
                                      <th style="text-align: right;">Price</th>
                                      </tr>
                                      <tr>
                                        <td>Deluxe Room</td>
                                        <td>x1</td>
                                        <td style="text-align: right;">5500.00</td>
                                      </tr> 
                                      <tr>
                                        <td style="text-align: left;">No.of Days Stayed</td>
                                        <td>x2</td>
                                        <td style="text-align: right;">11000.00</td>
                    
                                      </tr>
                                      <tr>
                                        <td style="text-align: left;">Extra Pax</td>
                                        <td></td>
                                        <td style="text-align: right;">500</td>
                                      </tr>
                                      <tr>
                                        <td style="text-align: left;"></td>
                                        <td>x2</td>
                                        <td style="text-align: right;">1000.00</td>
                                    </table>
                                    <hr style="border: 1px dashed #333; margin: 10px 0;">
                                    <table style="width: 100%; font-size: 13px; font-weight: bold;">
                                      <tr><td style="text-align: left;">Total</td><td></td><td style="text-align: right;">15000.00</td></tr>
                                      <tr><td style="text-align: left;">Cash Tendered</td><td></td><td style="text-align: right;">15000.00</td></tr>
                                      <tr><td style="text-align: left;">Change</td><td></td><td style="text-align: right;">0.00</td></tr>
                                    </table>
                                    <hr style="border: 1px dashed rgb(0, 0, 0); margin: 10px 0;">
                                    <p style="margin-top: 10px;">Thank you!</p>
                                    <hr style="border: 1px dashed #333; margin: 10px 0;">
                                  </div>
                                `,
            showConfirmButton: true,
            confirmButtonText: 'Print Receipt',
            confirmButtonColor: '#1a2d1e',
            width: 360,
            padding: '1.5em',
            backdrop: false
          })
        } else if (result.isDenied) {
          Swal.fire({
            title: '<strong>Finished activity on <br>time!</strong>',
            html: '<p style="color:#1a2d1e">Time Remaining: 1:12 Minutes<br>Time Consumed: 3:48 Minutes</p>',
            icon: 'success',
            customClass: {
              confirmButton: 'my-confirm-btn-booking',
              title: 'my-title-booking'
            },
            confirmButtonText: 'Close'
          })
        }
      })
    })
  </script>
{% endblock %}
