{% load static %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<div class="walkin-overlay">
  <div class="walkin-modal">
    <h2 class="walkin-modal-title">Walk-in</h2>

    <div class="walkin-container">
      <!-- Guest Info -->
      <div class="walkin-section">
        <div class="walkin-section-title">Guest Information</div>
        <div class="walkin-field">
          <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" />
          <label>Name</label><input type="text" class="walkin-name" />
        </div>
        <div class="walkin-field">
          <label>Address</label><input type="text" class="walkin-address" />
        </div>
        <div class="walkin-field">
          <label>Mobile no.</label><input type="text" class="walkin-mobile" />
        </div>
        <div class="walkin-field">
          <label>Date of Birth</label><input id="dob" type="text" placeholder="Birthday" class="walkin-birth" />
        </div>
        <div class="walkin-field">
          <label>Email</label><input type="email" class="walkin-email" />
        </div>

        <div class="walkin-section-title">Booking Information</div>
        <div class="walkin-field">
          <label>Room <span style="color: red;">*</span></label><select class="walkin-room" required>
            <option value="" disabled selected>Select Room First</option>
            <option value="1">Room 1 : Standard</option>
            <option value="2">Room 2 : Family</option>
            <option value="3">Room 3 : Deluxe</option>
            <option value="4">Room 4 : Standard</option>
            <option value="5">Room 5 : Family</option>
            <option value="6">Room 6 : Deluxe</option>
            <option value="7">Room 7 : Standard</option>
            <option value="8">Room 8 : Family</option>
            <option value="9">Room 9 : Deluxe</option>
            <option value="10">Room 10 : Standard</option>
            <option value="11">Room 11 : Family</option>
            <option value="12">Room 12 : Deluxe</option>
          </select>
        </div>
        <div class="walkin-inline-row">
          <div class="walkin-field">
            <label>Check-in Date</label><input id="checkin" type="text" class="walkin-check-in" disabled />
          </div>
          <div class="walkin-field">
            <label>Check-out Date</label><input id="checkout" type="text" class="walkin-check-out" disabled />
          </div>
        </div>
        <div class="walkin-inline-row">
          <div class="walkin-field">
            <label>Total Guests</label><input type="number" class="walkin-total-guest" />
          </div>
          <div class="walkin-field">
            <label>No. of Adults</label><input type="number" class="walkin-no-of-adults" />
          </div>
        </div>
        <div class="walkin-inline-row">
          <div class="walkin-field">
            <label>No. of Children</label><input type="number" class="walkin-no-of-children" />
          </div>
          <div class="walkin-field">
            <label>Add-ons</label>
            <div class="walkin-addons-dropdown" style="border: 1px solid #ccc; border-radius: 4px; padding: 6px 8px; background-color: #dddddd; cursor: pointer; position: relative; font-size: 11px; min-height: 44px; display: flex; align-items: flex-start;">
              <div class="d-flex justify-content-between align-items-center" style="width: 100%;">
                <div style="flex: 1;">
                  <div style="font-size: 11px; line-height: 1.1;">
                    <i class="bi bi-plus-circle" style="font-size: 9px;"></i> <strong id="addons-summary" style="font-size: 11px;">No add-ons selected</strong>
                  </div>
                  <small class="text-muted" id="addons-details" style="font-size: 10px; line-height: 1; display:block;">Select add-ons for your stay</small>
                </div>
                <i class="bi bi-chevron-down" style="font-size: 10px; margin-left: 5px;"></i>
              </div>

              <!-- Add-ons Popup -->
              <div class="addons-popup" id="addons-popup" style="position: absolute; bottom: 100%; left: 0; background: #f0f0f0; border: 2px solid #2e7d32; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); z-index: 10000; min-width: 260px; max-width: 260px; display: none; padding: 8px; margin-bottom: 6px;">
                <!-- Arrow pointing down to the trigger -->
                <div style="position: absolute; bottom: -9px; left: 20px; width: 0; height: 0; border-left: 9px solid transparent; border-right: 9px solid transparent; border-top: 9px solid #2e7d32;"></div>
                <div style="position: absolute; bottom: -7px; left: 20px; width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 8px solid #f0f0f0;"></div>
                <div class="addons-section" style="padding: 4px; border-bottom: 1px solid #eee;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <h6 style="margin: 0; color: #333; font-weight: 600; font-size: 12px;">Extra Bed</h6>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <button id="bed-minus" style="background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; width: 20px; height: 20px; cursor: pointer; font-size: 10px;">-</button>
                      <span id="bed-count" style="font-weight: bold; min-width: 20px; text-align: center; font-size: 12px;">0</span>
                      <button id="bed-plus" style="background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; width: 20px; height: 20px; cursor: pointer; font-size: 10px;">+</button>
                    </div>
                  </div>
                  <div style="font-size: 9px; color: #666; font-style: italic;">₱200 per bed</div>
                </div>

                <div class="addons-section" style="padding: 4px; border-bottom: 1px solid #eee;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <h6 style="margin: 0; color: #333; font-weight: 600; font-size: 12px;">Extra Pillow</h6>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <button id="pillow-minus" style="background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; width: 20px; height: 20px; cursor: pointer; font-size: 10px;">-</button>
                      <span id="pillow-count" style="font-weight: bold; min-width: 20px; text-align: center; font-size: 12px;">0</span>
                      <button id="pillow-plus" style="background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; width: 20px; height: 20px; cursor: pointer; font-size: 10px;">+</button>
                    </div>
                  </div>
                  <div style="font-size: 9px; color: #666; font-style: italic;">₱50 per pillow</div>
                </div>

                <div class="addons-section" style="padding: 4px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <h6 style="margin: 0; color: #333; font-weight: 600; font-size: 12px;">Extra Towel</h6>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <button id="towel-minus" style="background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; width: 20px; height: 20px; cursor: pointer; font-size: 10px;">-</button>
                      <span id="towel-count" style="font-weight: bold; min-width: 20px; text-align: center; font-size: 12px;">0</span>
                      <button id="towel-plus" style="background: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; width: 20px; height: 20px; cursor: pointer; font-size: 10px;">+</button>
                    </div>
                  </div>
                  <div style="font-size: 9px; color: #666; font-style: italic;">₱30 per towel</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="walkin-field">
          <label>Children Below 7 years old</label><input type="number" class="walkin-below-seven" />
        </div>
      </div>

      <!-- Payment Info -->
      <div class="walkin-section">
        <div class="walkin-section-title">Payment Info</div>
        <div class="walkin-field">
          <label>Payment Method</label><select class="walkin-payment-method">
            <option value="card" selected>Card Payment</option>
            <option value="cash">Cash Payment</option>
          </select>
        </div>
        <div class="walkin-card-fields">
          <div class="walkin-field">
            <label>Card Number</label>
            <input type="text" placeholder="(if applicable)" class="walkin-card-number" />
          </div>
          <div class="walkin-field">
            <label>Exp. Date</label>
            <input type="text" class="walkin-card-exp-date" />
          </div>
          <div class="walkin-field">
            <label>CVC</label>
            <input type="text" class="walkin-card-cvc" />
          </div>
        </div>

        <div class="walkin-field">
          <label>Billing Address</label><input type="text" class="walkin-billing-address" />
        </div>
        <div class="walkin-field">
          <label>Current Balance</label><input type="text" class="walkin-balance" />
        </div>

        <div class="walkin-btn-wrapper">
          <button class="walkin-book-btn">Book Room</button>
        </div>
        <div class="walkin-countdown">
          <div class="walkin-countdown-text">
            <div class="walkin-countdown-time">5:00</div>
            <div>Time Remaining</div>
          </div>
          <img src="{% static 'images/clock-timer.png' %}" alt="" />
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toggle billing/card visibility based on payment method -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const method = document.querySelector('.walkin-payment-method')
    const cardFields = document.querySelector('.walkin-card-fields')
    const billingField = document.querySelector('.walkin-billing-address')
    const roomSelect = document.querySelector('.walkin-room')
    const checkinField = document.querySelector('.walkin-check-in')
    const checkoutField = document.querySelector('.walkin-check-out')
  
    function applyPaymentVisibility() {
      const isCash = method && method.value === 'cash'
      if (cardFields) cardFields.style.display = isCash ? 'none' : ''
      if (billingField) {
        billingField.closest('.walkin-field').style.display = isCash ? 'none' : ''
        if (isCash) billingField.value = ''
      }
    }
  
    function toggleDateFields() {
      const isRoomSelected = roomSelect && roomSelect.value && roomSelect.value !== ''
      if (checkinField) {
        checkinField.disabled = !isRoomSelected
        if (!isRoomSelected) {
          checkinField.value = ''
          checkinField.placeholder = 'Select a room first'
        } else {
          checkinField.placeholder = 'Check-in Date'
        }
      }
      if (checkoutField) {
        checkoutField.disabled = !isRoomSelected
        if (!isRoomSelected) {
          checkoutField.value = ''
          checkoutField.placeholder = 'Select a room first'
        } else {
          checkoutField.placeholder = 'Check-out Date'
        }
      }
    }
  
    if (method) {
      method.addEventListener('change', applyPaymentVisibility)
      applyPaymentVisibility()
    }
  
    if (roomSelect) {
      roomSelect.addEventListener('change', toggleDateFields)
      toggleDateFields() // Initialize on page load
    }
  })
</script>
