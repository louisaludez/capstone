{% extends 'base.html' %}
{% load static %}

{% block title %}
  Available Rooms
{% endblock %}

{% block link %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
{% endblock %}

{% block extra_head %}
  <style>
    .results-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 40px;
    }
    
    .results-card {
      border: 1px solid #2e7d32;
      border-radius: 10px;
      padding: 20px;
      width: 100%;
      max-width: 1000px;
      background-color: #fff;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.05);
    }
    
    .search-summary {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .search-summary h6 {
      color: #2e7d32;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .search-details {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      font-size: 14px;
    }
    
    .search-detail {
      display: flex;
      align-items: center;
      gap: 5px;
      color: #495057;
    }
    
    .search-detail i {
      color: #2e7d32;
    }
    
    .tabs-container {
      border: 1px solid #2e7d32;
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .tabs-header {
      background: #f8f9fa;
      border-bottom: 1px solid #e9ecef;
      display: flex;
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      background: transparent;
      color: #495057;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .tab-btn.active {
      background: #2e7d32;
      color: white;
    }
    
    .tab-btn:hover:not(.active) {
      background: #e8f5e9;
    }
    
    .tab-content {
      padding: 20px;
    }
    
    .overview-content {
      line-height: 1.6;
      color: #495057;
    }
    
    .overview-content p {
      margin-bottom: 15px;
      font-size: 14px;
    }
    
    .rooms-grid {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .room-card {
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      background: #fff;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .room-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-color: #2e7d32;
    }
    
    .room-header {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .room-image {
      width: 200px;
      height: 120px;
      border-radius: 6px;
      object-fit: cover;
      flex-shrink: 0;
    }
    
    .room-info {
      flex: 1;
    }
    
    .room-title {
      font-size: 18px;
      font-weight: 600;
      color: #2e7d32;
      margin-bottom: 8px;
    }
    
    .room-capacity {
      color: #6c757d;
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .room-description {
      color: #495057;
      font-size: 14px;
      line-height: 1.4;
      margin-bottom: 10px;
    }
    
    .room-amenities {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .amenity-tag {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .room-policy {
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 10px;
    }
    
    .room-pricing {
      position: absolute;
      top: 20px;
      right: 20px;
      text-align: right;
    }
    
    .room-price {
      font-size: 24px;
      font-weight: 700;
      color: #2e7d32;
      margin-bottom: 5px;
    }
    
    .room-price-period {
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 8px;
    }
    
    .cancellation-info {
      font-size: 11px;
      color: #28a745;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .book-btn {
      background: #2e7d32;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .book-btn:hover {
      background: #1b5e20;
      transform: translateY(-1px);
    }
    
    .no-rooms {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }
    
    .no-rooms i {
      font-size: 48px;
      color: #dee2e6;
      margin-bottom: 15px;
    }
    
    .back-to-search {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      color: #495057;
      padding: 8px 16px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s ease;
    }
    
    .back-to-search:hover {
      background: #e9ecef;
      color: #495057;
      text-decoration: none;
    }
  </style>
{% endblock %}
{% block sidebar %}
  {% include './includes/sidebar.html' with active_page='home' %}
{% endblock %}

{% block content %}
  <div class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="results-card">
      <!-- Back to Search -->
      <div class="mb-3">
        <a href="{% url 'guest_booking_home' %}" class="back-to-search">
          <i class="bi bi-arrow-left"></i>
          Back to Search
        </a>
      </div>

      <!-- Search Summary -->
      <div class="search-summary">
        <h6><i class="bi bi-search"></i> Your Search Details</h6>
        <div class="search-details">
          <div class="search-detail">
            <i class="bi bi-calendar-check"></i>
            <span>Check-in: <strong>{{ checkin_date|date:'M d, Y' }}</strong></span>
          </div>
          <div class="search-detail">
            <i class="bi bi-calendar-x"></i>
            <span>Check-out: <strong>{{ checkout_date|date:'M d, Y' }}</strong></span>
          </div>
          <div class="search-detail">
            <i class="bi bi-people"></i>
            <span>
              <strong>{{ adults }} Adult{{ adults|pluralize }}</strong>{% if children > 0 %}
                , <strong>{{ children }} Child{{ children|pluralize }}</strong>
              {% endif %}
            </span>
          </div>
          <div class="search-detail">
            <i class="bi bi-door-open"></i>
            <span><strong>{{ rooms }} Room{{ rooms|pluralize }}</strong></span>
          </div>
          <div class="search-detail">
            <i class="bi bi-moon"></i>
            <span><strong>{{ stay_type|title }} Stay</strong></span>
          </div>
        </div>
      </div>

      <!-- Tabs Container -->
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-btn active" data-tab="overview"><i class="bi bi-info-circle"></i> Overview</button>
          <button class="tab-btn" data-tab="rooms"><i class="bi bi-door-open"></i> Available Rooms ({{ rooms|length }})</button>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content" id="overview-tab">
          <div class="overview-content">
            <h5 class="mb-3" style="color: #2e7d32;">Welcome to ACPI Hotel</h5>
            <p>Where comfort meets sophistication in the heart of the city. Whether you're traveling for business or leisure, our hotel offers a seamless blend of modern amenities and warm hospitality to make your stay exceptional.</p>
            <p>Each of our thoughtfully designed rooms and suites features plush bedding, high-speed Wi-Fi, flat-screen Smart TVs, and spacious bathrooms with premium toiletries.</p>
            <p>Conveniently located near key attractions, shopping centers, and business districts, ACPI Hotel offers the perfect base for exploring the city or getting work done. With its inviting ambiance, attentive staff, and top-tier amenities, our hotel ensures a memorable stay from check-in to check-out.</p>
          </div>
        </div>

        <!-- Rooms Tab -->
        <div class="tab-content" id="rooms-tab" style="display: none;">
          {% if rooms %}
            <div class="rooms-grid">
              {% for room in rooms %}
                <div class="room-card">
                  <div class="room-header">
                    <img src="{% static 'images/room.png' %}" alt="{{ room.name }}" class="room-image" />
                    <div class="room-info">
                      <div class="room-title">{{ room.name }}</div>
                      <div class="room-capacity">
                        <i class="bi bi-people"></i> Good for {{ room.capacity }} person{{ room.capacity|pluralize }}
                      </div>
                      <div class="room-description">{{ room.description }}</div>
                      <div class="room-amenities">
                        <span class="amenity-tag"><i class="bi bi-wifi"></i> Free WiFi</span>
                        <span class="amenity-tag"><i class="bi bi-car-front"></i> Parking</span>
                        <span class="amenity-tag"><i class="bi bi-tv"></i> Smart TV</span>
                        <span class="amenity-tag"><i class="bi bi-droplet"></i> Private Bathroom</span>
                      </div>
                      <div class="room-policy">
                        <i class="bi bi-info-circle"></i> {{ room.policy }}
                      </div>
                    </div>
                  </div>

                  <div class="room-pricing">
                    <div class="room-price">â‚±{{ room.price_per_night }}</div>
                    <div class="room-price-period">per night</div>
                    <div class="cancellation-info">
                      <i class="bi bi-check-circle"></i> FREE cancellation
                    </div>
                    <div class="room-policy" style="font-size: 11px; margin-bottom: 10px;">before check-in date</div>
                    <button class="book-btn" onclick="bookRoom({{ room.id }})"><i class="bi bi-calendar-plus"></i> Book Now</button>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="no-rooms">
              <i class="bi bi-house-x"></i>
              <h5>No Rooms Available</h5>
              <p>Sorry, no rooms match your search criteria for the selected dates.</p>
              <a href="{% url 'guest_booking_home' %}" class="back-to-search">
                <i class="bi bi-arrow-left"></i>
                Try Different Dates
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script>
    // Tabs switching
    document.addEventListener('DOMContentLoaded', function () {
      const tabButtons = document.querySelectorAll('.tab-btn')
      const overviewTab = document.getElementById('overview-tab')
      const roomsTab = document.getElementById('rooms-tab')
    
      function showTab(tabName) {
        // Hide all tabs
        overviewTab.style.display = 'none'
        roomsTab.style.display = 'none'
    
        // Remove active class from all buttons
        tabButtons.forEach((btn) => btn.classList.remove('active'))
    
        // Show selected tab and activate button
        if (tabName === 'overview') {
          overviewTab.style.display = 'block'
          document.querySelector('.tab-btn[data-tab="overview"]').classList.add('active')
        } else if (tabName === 'rooms') {
          roomsTab.style.display = 'block'
          document.querySelector('.tab-btn[data-tab="rooms"]').classList.add('active')
        }
      }
    
      // Add click listeners to tab buttons
      tabButtons.forEach((button) => {
        button.addEventListener('click', function () {
          const tabName = this.getAttribute('data-tab')
          showTab(tabName)
        })
      })
    
      // Default to overview tab
      showTab('overview')
    })
    
    // Book room function
    function bookRoom(roomId) {
      // Store room ID for the booking process
      localStorage.setItem('selectedRoomId', roomId)
    
      // Persist selected dates and guest counts from query params
      try {
        const params = new URLSearchParams(window.location.search)
        const checkin = params.get('checkin')
        const checkout = params.get('checkout')
        const rooms = params.get('rooms')
        const adults = params.get('adults')
        const children = params.get('children')
        const stayType = params.get('stayType')
    
        if (checkin) localStorage.setItem('selectedCheckinDate', checkin)
        if (checkout) localStorage.setItem('selectedCheckoutDate', checkout)
        if (rooms) localStorage.setItem('numRooms', rooms)
        if (adults) localStorage.setItem('numAdults', adults)
        if (children) localStorage.setItem('numChildren', children)
        if (stayType) localStorage.setItem('stayType', stayType)
    
        console.log('[guestbooking/results] saved selection to storage:', {
          roomId,
          checkin,
          checkout,
          rooms,
          adults,
          children,
          stayType
        })
      } catch (e) {
        console.warn('[guestbooking/results] failed to persist selection', e)
      }
    
      // Redirect to book reservation page
      window.location.href = '/guestbooking/book-reservation/'
    }
  </script>
{% endblock %}
