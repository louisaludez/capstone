{% extends './base.html' %}
{% load static %}

{% block title %}Registered HMS Users | ACES HMS{% endblock %}

{% block sidebar %}
{% include 'includes/hms-admin-sidebar.html' with active_page='accounts' %}
{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Registered HMS Users</h1>
  <div class="d-flex">
    <div class="input-group">
      <button class="btn btn-outline-secondary dropdown-toggle" type="button">
        <i class="bi bi-funnel"></i> Filter
      </button>
      <button class="btn btn-outline-secondary dropdown-toggle" type="button">
        Sort <i class="bi bi-sort-down"></i>
      </button>
    </div>
    <div class="input-group ms-2">
      <input id="customSearch" type="text" class="form-control" placeholder="Search" />
      <button id="customSearchBtn" class="btn btn-outline-secondary" type="button">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table id="usersTable" class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th width="40"><input type="checkbox" /></th>
            <th>User ID.</th>
            <th>Username</th>
            <th>Role</th>
            <th>Registration Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td><input type="checkbox" /></td>
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.role }}</td>
            <td>
              {{ user.date_joined|time:"H:i" }}<br />
              {{ user.date_joined|date:"d/m/Y" }}
            </td>
            <td>
              {% if user.status == 'pending' %}
              <span class="badge bg-warning">Pending</span>
              {% elif user.status == 'finished' %}
              <span class="badge bg-success">Finished</span>
              {% elif user.status == 'cancelled' %}
              <span class="badge bg-danger">Cancelled</span>
              {% else %}
              <span class="badge bg-secondary">{{ user.status }}</span>
              {% endif %}
            </td>
            <td>
              <button class="btn btn-sm btn-link"><i class="bi bi-eye"></i></button>
              <button class="btn btn-sm btn-link"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-link text-danger"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center">No users found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  $(function () {
    // Initialize DataTable without its built-in search box
    var table = $('#usersTable').DataTable({
      paging: true,
      pageLength: 10,
      lengthChange: false,
      info: false,
      searching: false,  // disable default search
      order: [], // disable initial sort
      columnDefs: [{ orderable: false, targets: [0, 6] }]
    });

    // Custom search input and button hooked to DataTables search
    $('#customSearch').on('input', function () {
      table.search(this.value).draw();
    });
    $('#customSearchBtn').on('click', function () {
      table.search($('#customSearch').val()).draw();
    });
  });
</script>
{% endblock %}